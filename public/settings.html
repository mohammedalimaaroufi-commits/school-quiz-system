<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Pro - Ù…Ø¯Ø±Ø³Ø© Ø§Ø¨Ù† Ø¯Ø±ÙŠØ¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2fe; --accent: #ffd700; --bg: #080a0c;
            --card: rgba(23, 28, 35, 0.8); --success: #00ff88;
            --danger: #ff4757; --info: #448aff; --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; }
        body { background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; }

        /* Header */
        .admin-header { 
            height: 70px; background: rgba(0,0,0,0.4); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass); display: flex; align-items: center; 
            justify-content: space-between; padding: 0 30px; z-index: 1000;
        }

        .main-layout { display: grid; grid-template-columns: 420px 1fr; gap: 20px; padding: 20px; height: calc(100vh - 70px); }

        .sidebar { display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding-left: 5px; }
        .control-card { 
            background: var(--card); border-radius: 20px; padding: 20px; 
            border: 1px solid var(--glass); backdrop-filter: blur(12px);
        }

        .section-title { color: var(--accent); font-size: 1.1rem; margin-bottom: 15px; font-weight: 900; display: flex; align-items: center; gap: 10px; }

        /* Scores & Turns */
        .score-box { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .team-score { 
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 18px; 
            text-align: center; border: 2px solid transparent; position: relative;
        }
        .team-score.is-turn { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 254, 0.3); }
        .score-val { font-size: 3rem; font-weight: 900; color: var(--primary); margin: 5px 0; }

        /* Rounds UI */
        .btn-round { background: var(--glass); color: #777; border: 1px solid var(--glass); padding: 10px; border-radius: 12px; cursor: pointer; font-weight: bold; flex: 1; }
        .btn-round.active { background: var(--primary); color: #000; font-weight: 900; }

        /* Media Setup Style */
        .team-setup-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .logo-box { 
            width: 65px; height: 65px; background: #1a1e26; border-radius: 50%; 
            margin: 0 auto 10px; border: 2px dashed var(--primary); 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; overflow: hidden; position: relative;
        }
        .logo-box img { width: 100%; height: 100%; object-fit: cover; }
        .video-status { font-size: 0.6rem; color: var(--success); display: none; margin-top: 4px; font-weight: bold; }

        /* Question Center */
        .center-panel { display: flex; flex-direction: column; gap: 20px; }
        .q-preview-box { 
            background: radial-gradient(circle at top right, #1a202c, #080a0c);
            border-radius: 25px; padding: 35px; flex: 1; display: flex; 
            flex-direction: column; border: 1px solid var(--glass);
        }
        .q-meta { background: var(--primary); color: #000; padding: 5px 15px; border-radius: 8px; font-weight: 900; font-size: 0.9rem; width: fit-content; }
        .q-text-display { font-size: 2.3rem; font-weight: 800; margin: 25px 0; line-height: 1.4; color: #fff; }

        .ans-pill { background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success); color: var(--success); padding: 15px; border-radius: 12px; display: none; font-size: 1.2rem; font-weight: 700; }

        /* Inputs & Buttons */
        input[type="text"] { width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--glass); padding: 10px; color: white; border-radius: 10px; text-align: center; margin-bottom: 8px; }
        .btn-main { padding: 12px; border-radius: 12px; border: none; font-weight: 900; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        #level-select-panel { display: none; flex-direction: column; gap: 10px; margin-top: 15px; }
        .level-row { display: grid; grid-template-columns: 90px 1fr 1fr 1fr 1fr; gap: 8px; align-items: center; background: rgba(255,255,255,0.02); padding: 8px; border-radius: 15px; }
        .q-btn { padding: 8px; border-radius: 8px; border: 1px solid var(--glass); background: #1a1e26; color: white; cursor: pointer; font-size: 0.8rem; }
        .q-btn.used { opacity: 0.2; pointer-events: none; }

        #alert-banner { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; padding: 15px 40px; border-radius: 20px; display: none; border: 2px solid white; font-weight: 900; }
    </style>
</head>
<body>

    <div id="alert-banner"></div>

    <header class="admin-header">
        <div style="display:flex; align-items:center; gap:10px;">
            <span style="font-size: 1.5rem;">âš™ï¸</span>
            <h1 style="margin:0; font-size: 1.3rem;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… <span style="color:var(--primary)">PRO</span></h1>
        </div>
        <button class="btn-main" style="background:rgba(255, 71, 87, 0.1); color:var(--danger); border:1px solid var(--danger); padding: 5px 15px;" onclick="resetCompetition()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
    </header>

    <main class="main-layout">
        <aside class="sidebar">
            
            <div class="control-card">
                <div class="section-title">ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</div>
                <div class="score-box">
                    <div class="team-score" id="box-g1">
                        <div id="disp-name1" style="font-weight:bold; opacity:0.6; font-size:0.8rem;">ÙØ±ÙŠÙ‚ 1</div>
                        <div id="val-s1" class="score-val">0</div>
                        <div style="display:flex; gap:5px;">
                            <button class="q-btn" style="flex:1" onclick="adjScore('group1', 1)">+1</button>
                            <button class="q-btn" style="flex:1" onclick="adjScore('group1', -1)">-1</button>
                        </div>
                    </div>
                    <div class="team-score" id="box-g2">
                        <div id="disp-name2" style="font-weight:bold; opacity:0.6; font-size:0.8rem;">ÙØ±ÙŠÙ‚ 2</div>
                        <div id="val-s2" class="score-val">0</div>
                        <div style="display:flex; gap:5px;">
                            <button class="q-btn" style="flex:1" onclick="adjScore('group2', 1)">+1</button>
                            <button class="q-btn" style="flex:1" onclick="adjScore('group2', -1)">-1</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="control-card">
                <div class="section-title">ğŸ•¹ï¸ Ø§Ù„Ù…Ø±Ø§Ø­Ù„</div>
                <div style="display:flex; gap:8px; margin-bottom:12px;">
                    <button class="btn-round" id="rb1" onclick="setRound(1)">1</button>
                    <button class="btn-round" id="rb2" onclick="setRound(2)">Ø§Ù„Ø³Ø±Ø¹Ø©</button>
                    <button class="btn-round" id="rb3" onclick="setRound(3)">Ø§Ù„ØªØ­Ø¯ÙŠ</button>
                </div>
                <button class="btn-main" style="background:var(--danger); color:white; width:100%" onclick="finishGame()">ğŸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
            </div>

            <div class="control-card">
                <div class="section-title">ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ù„ÙŠØ©</div>
                <div class="team-setup-grid">
                    <div>
                        <div class="logo-box" onclick="document.getElementById('f-l1').click()">
                            <img id="p-l1" src="">
                            <span id="txt-l1" style="font-size:0.6rem; text-align:center">Ù„ÙˆØ¬Ùˆ 1</span>
                        </div>
                        <input type="file" id="f-l1" hidden onchange="previewMedia(this, 'p-l1', 'txt-l1')">
                        <input type="text" id="in-n1" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 1">
                        <button class="q-btn" style="width:100%; border-color:var(--accent)" onclick="document.getElementById('f-v1').click()">ğŸ¬ ÙÙŠØ¯ÙŠÙˆ 1</button>
                        <input type="file" id="f-v1" hidden accept="video/*" onchange="storeMedia(this, 'v1-data', 'v1-stat')">
                        <div id="v1-stat" class="video-status">âœ… Ø¬Ø§Ù‡Ø²</div>
                        <input type="hidden" id="v1-data">
                    </div>
                    <div>
                        <div class="logo-box" onclick="document.getElementById('f-l2').click()">
                            <img id="p-l2" src="">
                            <span id="txt-l2" style="font-size:0.6rem; text-align:center">Ù„ÙˆØ¬Ùˆ 2</span>
                        </div>
                        <input type="file" id="f-l2" hidden onchange="previewMedia(this, 'p-l2', 'txt-l2')">
                        <input type="text" id="in-n2" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ 2">
                        <button class="q-btn" style="width:100%; border-color:var(--accent)" onclick="document.getElementById('f-v2').click()">ğŸ¬ ÙÙŠØ¯ÙŠÙˆ 2</button>
                        <input type="file" id="f-v2" hidden accept="video/*" onchange="storeMedia(this, 'v2-data', 'v2-stat')">
                        <div id="v2-stat" class="video-status">âœ… Ø¬Ø§Ù‡Ø²</div>
                        <input type="hidden" id="v2-data">
                    </div>
                </div>
                <div style="margin-top:10px; background:rgba(0,0,0,0.2); padding:10px; border-radius:12px;">
                    <label style="font-size:0.7rem; color:var(--primary)">Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (JSON):</label>
                    <input type="file" id="jsonInput" accept=".json" style="font-size:0.7rem; width:100%">
                </div>
                <button class="btn-main" style="background:var(--primary); color:#000; width:100%; margin-top:12px;" onclick="saveConfig()">ØªØ¬Ù‡ÙŠØ² ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¨Ø« ğŸš€</button>
            </div>
        </aside>

        <section class="center-panel">
            <div class="q-preview-box">
                <div class="q-meta" id="preview-meta">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</div>
                <div id="preview-text" class="q-text-display">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...</div>
                <div id="ans-preview" class="ans-pill"></div>

                <div id="level-select-panel">
                    <div class="level-row">
                        <div style="color:var(--success); font-weight:900; font-size:0.8rem;">ğŸŸ¢ Ø¹Ø§Ø¯ÙŠ</div>
                        <button class="q-btn" onclick="pushSpecific('normal', 0, this)">1</button>
                        <button class="q-btn" onclick="pushSpecific('normal', 1, this)">2</button>
                        <button class="q-btn" onclick="pushSpecific('normal', 2, this)">3</button>
                        <button class="q-btn" onclick="pushSpecific('normal', 3, this)">4</button>
                    </div>
                    <div class="level-row">
                        <div style="color:#e67e22; font-weight:900; font-size:0.8rem;">ğŸŸ  ØµØ¹Ø¨</div>
                        <button class="q-btn" onclick="pushSpecific('hard', 0, this)">1</button>
                        <button class="q-btn" onclick="pushSpecific('hard', 1, this)">2</button>
                        <button class="q-btn" onclick="pushSpecific('hard', 2, this)">3</button>
                        <button class="q-btn" onclick="pushSpecific('hard', 3, this)">4</button>
                    </div>
                    <div class="level-row">
                        <div style="color:var(--danger); font-weight:900; font-size:0.8rem;">ğŸ”´ Ø®Ø§Ø±Ù‚</div>
                        <button class="q-btn" onclick="pushSpecific('super', 0, this)">1</button>
                        <button class="q-btn" onclick="pushSpecific('super', 1, this)">2</button>
                        <button class="q-btn" onclick="pushSpecific('super', 2, this)">3</button>
                        <button class="q-btn" onclick="pushSpecific('super', 3, this)">4</button>
                    </div>
                </div>
            </div>

            <div class="control-card" style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:12px;">
                <button id="btn-next" class="btn-main" style="background:var(--info); color:white" onclick="pushAutoNext()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
                <button class="btn-main" style="background:var(--success); color:#000" onclick="socket.emit('revealAnswer')">ÙƒØ´Ù Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
                <button class="btn-main" style="background:var(--danger); color:white" onclick="socket.emit('resetBuzzer')">ØªØµÙÙŠØ± Ø§Ù„Ø¨Ø§Ø²Ø±</button>
            </div>
        </section>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let questionsBank = null;
        let activeRound = 0;
        let indices = { r1: 0, r2: 0 };

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ Ø§Ù„Ù…Ø¶Ø§ÙØ©
        function previewMedia(input, imgId, txtId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById(imgId).src = e.target.result;
                    document.getElementById(imgId).style.display = "block";
                    document.getElementById(txtId).style.display = "none";
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function storeMedia(input, hiddenId, statId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById(hiddenId).value = e.target.result;
                    document.getElementById(statId).style.display = "block";
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        document.getElementById('jsonInput').onchange = (e) => {
            const reader = new FileReader();
            reader.onload = (ev) => { questionsBank = JSON.parse(ev.target.result); alert("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©"); };
            reader.readAsText(e.target.files[0]);
        };

        function saveConfig() {
            const config = {
                t1: document.getElementById('in-n1').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 1",
                t2: document.getElementById('in-n2').value || "Ø§Ù„ÙØ±ÙŠÙ‚ 2",
                logo1: document.getElementById('p-l1').src.startsWith('data') ? document.getElementById('p-l1').src : null,
                logo2: document.getElementById('p-l2').src.startsWith('data') ? document.getElementById('p-l2').src : null,
                video1: document.getElementById('v1-data').value || null,
                video2: document.getElementById('v2-data').value || null
            };
            socket.emit('setupGame', config);
            alert("ğŸš€ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ¨Ø¯Ø¡ Ø§Ù„Ø¨Ø«");
        }

        function setRound(r) {
            activeRound = r;
            socket.emit('changeRound', r);
            document.querySelectorAll('.btn-round').forEach(b => b.classList.remove('active'));
            document.getElementById('rb' + r).classList.add('active');
            const isR3 = (r === 3);
            document.getElementById('level-select-panel').style.display = isR3 ? 'flex' : 'none';
            document.getElementById('btn-next').style.display = isR3 ? 'none' : 'flex';
            document.getElementById('ans-preview').style.display = 'none';
            document.getElementById('preview-text').innerText = "Ø§Ù„Ø¬ÙˆÙ„Ø© " + r + ": Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„";
        }

        function pushAutoNext() {
            if(!questionsBank) return alert("Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹");
            const qSet = questionsBank['round' + activeRound];
            if(!qSet || indices['r'+activeRound] >= qSet.length) return alert("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø©");
            const q = qSet[indices['r'+activeRound]];
            socket.emit('pushQuestion', q);
            renderPreview(q, `Ø¬ÙˆÙ„Ø© ${activeRound}`);
            indices['r'+activeRound]++;
        }

        function pushSpecific(level, idx, btn) {
            if(!questionsBank) return;
            const q = questionsBank.round3[level][idx];
            q.points = { 'normal': 2, 'hard': 5, 'super': 10 }[level];
            socket.emit('pushQuestion', q);
            btn.classList.add('used');
            renderPreview(q, `ØªØ­Ø¯ÙŠ - ${level}`);
        }

        function renderPreview(q, meta) {
            document.getElementById('preview-meta').innerText = meta;
            document.getElementById('preview-text').innerText = q.question;
            const ansDiv = document.getElementById('ans-preview');
            ansDiv.innerText = "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: " + q.options[q.answer];
            ansDiv.style.display = "block";
        }

        function resetCompetition() { if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ")) socket.emit('resetGameFull'); }
        function adjScore(team, val) { socket.emit('manualScore', { team, val }); }
        function finishGame() { if(confirm("Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŸ")) socket.emit('endGame'); }

        socket.on('gameStateUpdate', (state) => {
            document.getElementById('val-s1').innerText = state.teams.group1.score;
            document.getElementById('val-s2').innerText = state.teams.group2.score;
            document.getElementById('disp-name1').innerText = state.teams.group1.name;
            document.getElementById('disp-name2').innerText = state.teams.group2.name;
            document.getElementById('box-g1').classList.toggle('is-turn', state.currentTurn === 'group1');
            document.getElementById('box-g2').classList.toggle('is-turn', state.currentTurn === 'group2');
        });

        socket.on('levelSelectedAlert', (data) => {
            const b = document.getElementById('alert-banner');
            b.style.display = 'block'; b.style.background = '#ffd700'; b.style.color = '#000';
            b.innerText = `ğŸ”” ${data.teamName} Ø§Ø®ØªØ§Ø± Ù…Ø³ØªÙˆÙ‰: ${data.level}`;
            setTimeout(() => b.style.display = 'none', 4000);
        });
    </script>
</body>
</html>